---
sidebar_position: 4
---

# 变量与逻辑

Arrow 拥有多种功能，使其成为设计和开发非线性交互式文档的强大工具，
特别适用于制作故事丰富的游戏。

*变量*和节点（如 [User-Input](../nodes/user-input)、[Variable-Update](../nodes/variable-update)、[Condition](../nodes/condition) 等）
是其中的一些功能，帮助开发者在完全可视化的开发环境中为项目引入逻辑。

在本文档中，我们回顾帮助扩展工作逻辑方面的最重要功能。

> 请务必查看[内置节点](../nodes/condition)的文档页面。
> 另外浏览*[角色](./characters)*文档以了解更多关于其有趣潜力的信息。

## 基础

Arrow 中有三种变量类型：

+ 数字（num）：保存整数
+ 布尔值（bool）：保存二进制状态（即 `True` 或 `False`）
+ 字符串（str）：保存文本

Arrow 中的变量在文档范围内是全局的，因此每个场景和节点都可以读取或写入它们。

要创建变量，请切换到*检查器*面板中的相应选项卡。

> 你可能需要使用选项卡栏右上角的箭头按钮
> 来显示其他选项卡，或使用面板标题栏上的选择器按钮。

你可以在那里创建和修改任何变量的初始值，
但请记住，你需要按 `设置` 按钮来保留更改。

## 变量修改

我们可以在运行时使用修改器节点修改任何变量的当前值：

+ [User-Input](../nodes/user-input) 节点显示可自定义的提示消息和输入控件（带有验证），
然后用从玩家那里收到的输入替换其目标变量的当前值。

+ [Variable-Update](../nodes/variable-update) 节点修改其目标变量的当前值。
任何变量类型都有自己的一组操作，不支持类型转换。
一些操作接受另一个变量作为公式的右侧；
在这种情况下，如果你选择相同的变量，将使用变量的初始值作为右侧。

+ [Generator](../nodes/generator) 节点可以在运行时为任何变量创建和设置值。
根据目标变量的类型，有不同的值生成方法。
每种方法都有一组可编辑的选项/规则，定义如何创建值。
例如，可以从一个范围随机生成整数，并可能限制为奇数或偶数。

## 变量暴露（解析）

要在具有文本字段的节点类型中暴露变量，包括 [Dialog](../nodes/dialog)、[Interaction](../nodes/interaction)、[Content](../nodes/content) 等，
请使用大括号中的变量名称，即类似 `{variable_name}` 的 mustache 占位符。
当播放此类节点时，Arrow 控制台和任何兼容的运行时
将用变量的当前值替换它们。

以以下文本内容为例：

```
你好 {HERO_NAME}！
我是 RxD{ROBOT_CODE}，你的机器人向导。
```

如果 `HERO_NAME`（str）的当前值是 `Luke`
并且 `ROBOT_CODE`（num）是 `7`，它将被翻译为下一个块：

```
你好 Luke！
我是 RxD7，你的机器人向导。
```

一般来说，变量的命名由你决定。
我们建议遵循约定，比如始终使用有意义的 snake_case 名称。
然而，Arrow 编辑器可能会对你的变量名强制一些限制。
它可能会替换某些字符以使名称可以安全暴露，即避免大括号、点等，
或者用额外的字符（默认为下划线 `_`）作为后缀以防止重复。

> 由于底层的连续性安全机制，如果你重命名一个变量，
> Arrow 会自动为你修改所有暴露它的地方。

## 条件节点

[Condition](../nodes/condition) 节点比较其目标变量的当前值

+ 与指定的值，
+ 与另一个变量的当前值
+ 或与变量本身的初始值

在运行时进行比较。

条件节点使用类型化运算符比较其目标变量的当前状态。
例如，可以检查一个数字是否大于、小于或等于另一个数字，
而字符串可以检查其长度或匹配模式；
但我们不能将数字与布尔值或字符串进行比较，即使是数字的文本表示。
换句话说，不支持自动解析或类型转换。

## 使用方法

为你的 Arrow 冒险添加逻辑可以将它们提升到更高的交互性级别。
然而，你可能不需要在任何地方都使用变量、其修改器或条件。

推荐的方法是尽可能使用 Arrow 的[导航](./navigation-plot)功能来控制事件序列。
这些功能更容易使用和维护，而且性能更好。

当故事需要控制一些值（如库存、分数等）时，可以利用逻辑。
例如，你可以为玩家或角色定义 HP（生命点数）变量
并在每次战斗后更新它们；然后你可以使用 [Condition](../nodes/condition) 节点来查看他们是否还活着
（`HP > 0`）或者你需要 [Jump](../nodes/jump) 玩家到来世场景并复活他们！

> 快速提示！
> 如果你打算在故事中多次检查一个变量，或需要一个可重复的逻辑块，
> 可以创建一个宏并通过 [Macro-Use](../nodes/macro-use) 节点任意次数地重用它。

## 另请参阅：

+ [角色](./characters)：了解使用标签扩展游戏逻辑的有趣方式。
